---
apiVersion: v1
kind: ConfigMap
metadata:
  name: test
  namespace: dragonfly
data:
  foo: bar
---
apiVersion: v1
kind: Secret
metadata:
  name: test
  namespace: dragonfly
stringData:
  foo: bar
---
apiVersion: dragonfly.pborn.eu/v1alpha1
kind: Dragonfly
metadata:
  name: dragonfly
  namespace: dragonfly
spec:
  replicaCount: 1
---
apiVersion: dragonfly.pborn.eu/v1alpha1
kind: Dragonfly
metadata:
  name: dragonfly-tls
  namespace: dragonfly
spec:
  replicaCount: 1
  tls:
    existingSecret:
      secretName: dragonfly-server-tls
  podMonitor: true
---
apiVersion: dragonfly.pborn.eu/v1alpha1
kind: Dragonfly
metadata:
  name: dragonfly-stateful-without-storage-request
  namespace: dragonfly
spec:
  replicaCount: 1
  statefulMode: true
---
apiVersion: dragonfly.pborn.eu/v1alpha1
kind: Dragonfly
metadata:
  name: dragonfly-stateful-with-storage-request
  namespace: dragonfly
spec:
  replicaCount: 1
  statefulMode: true
  statefulStorage:
    resources:
      requests:
        storage: 10Gi
---
apiVersion: dragonfly.pborn.eu/v1alpha1
kind: Dragonfly
metadata:
  name: dragonfly-to-the-moon
  namespace: dragonfly
spec:
  podMonitor: true
  configMaps:
    - test
  secrets:
    - test
  commandOverride:
    - /usr/local/bin/dragonfly
  image:
    repository: ghcr.io/tamcore/dragonfly
    tag: alpha-alpine
  initContainers:
    - name: initcontainer
      image: busybox:1.28
      command: ["/bin/sh"]
      args: ["-c", "date; sleep 1;"]
  containers:
    - name: sidecar
      image: busybox:latest
      command: ["/bin/sh"]
      args: ["-c", "date; sleep 3600;"]
  replicaCount: 1
  redisPort: "10000"
  memcachePort: "10001"
  extraArgs:
    - --dbnum=1
    - --maxmemory=500M
    - --proactor_threads=1
    - --conn_threads=1
    - --compression_mode=0
    - --cache_mode=true
    - --version_check=false
  resources:
    limits:
      cpu: 100m
      memory: 1000Mi
    requests:
      cpu: 100m
      memory: 100Mi
  securityContext:
    capabilities:
      add:
      - IPC_LOCK
    readOnlyRootFilesystem: true
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 65534
    runAsGroup: 65534
    fsGroup: 65534
    fsGroupChangePolicy: "OnRootMismatch"
  nodeSelector:
    kubernetes.io/hostname: k3s-worker-a0e3.pb.home
  tolerations:
    - effect: NoSchedule
      operator: Exists
  volumes:
    - name: tmp
      emptyDir:
        sizeLimit: 500Mi
  volumeMounts:
    - mountPath: /tmp
      name: tmp